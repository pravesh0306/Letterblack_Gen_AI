
The provided HTML is a well-structured foundation for your After Effects AI assistant CEP extension, with clear organization - **AE Integration Hints**: The `app-initializer.js` and `advanced-sdk-integration.js` scripts should expose AE-specific functions (e.g., `app.project`, `app.beginUndoGroup`) to the UI. Add comments or ensure these are accessible globally (if not already).  

- **Mascot Animation**: The mascot uses a GIF animation (`ae-mascot-animated.gif`) which provides consistent animation across all browsers and CEP environments.  

---

### **5---

### **11. **Dependency and Module Checks****  
- **Issue**: `initMascot` assumes `MascotAnimator` is globally available but doesn't handle initialization failures.  
- **Fix**: Add fallback behavior:  
  ```javascript
  function initMascot() { 
      try { 
          if (typeof MascotAnimator !== 'undefined') { 
              const mascot = new MascotAnimator({
                  mascotGif: 'assets/ae-mascot-animated.gif', // Use GIF animationdling & Logging**  
- **Voice Input Error Feedback**: If voice input fails (e.g., user denies microphone access), the UI should notify the user. Add a `role="alert"` to a hidden message that's shown on errors.  ntion to UI components like tabs, settings, and chat areas. However, there are **opportunities to enhance accessibility, dynamic behavior, performance, and CEP-specific compatibility**. Below is a detailed breakdown of improvements:

---

### **1. Accessibility Enhancements**  
#### **Missing ARIA Roles/Labels**  
- **Breadcrumb Navigation**: The `nav.breadcrumb` lacks `role="navigation"` and an explicit `aria-label`.  
  **Fix**:  
  ```html
  
      Comp
      ›
      Layer
      ›
      Property
  
  ```  

- **Chat Messages Container**: Each `.message` div in `#chat-messages` should have `role="article"` for screen readers.  
  **Fix**:  
  ```html
  
      
  
  ```  

- **Voice Input Button**: The `#voice-input-btn` has a `title`, but the `recording-indicator` div lacks context. Add `aria-label` to clarify its state.  
  **Fix**:  
  ```html
  
      
       
  
  ```  

- **Tab Pane Status**: `.tab-pane` elements should use `aria-expanded` to indicate visibility.  
  **Fix**:  
  ```html
  
      
  
  ```  

#### **Dynamic Content Updates**  
- **Char Count**: The `char-count` span (0/1000) should update in real-time as the user types in `#chat-input`. Add this script:  
  ```javascript
  // Inside ui-bootstrap.js or a dedicated event handler
  const chatInput = document.getElementById('chat-input');
  const charCount = document.querySelector('.char-count');
  if (chatInput && charCount) {
      chatInput.addEventListener('input', (e) => {
          const current = e.target.value.length;
          charCount.textContent = `${current}/1000`;
      });
  }
  ```  

- **Voice Rate Display**: The `#speech-rate` range input’s adjacent `span.range-value` should update dynamically as the user drags.  
  **Fix**:  
  ```javascript
  // Add event listener to speech-rate range
  const speechRate = document.getElementById('speech-rate');
  const speechRateValue = document.querySelector('#speech-rate + .range-value');
  if (speechRate && speechRateValue) {
      speechRate.addEventListener('input', (e) => {
          speechRateValue.textContent = `${e.target.value}x`;
      });
  }
  ```  

---

### **2. Performance & Resource Optimization**  
- **Prism.js CDN Dependency**: Loading Prism from a CDN (`https://cdnjs...`) risks CORS errors or blocked requests in CEP environments (common in enterprise setups).  
  **Fix**: Bundle Prism locally (copy files to `js/utils/`) and update the script tags:  
  ```html
  
  
  
  
  ```  

- **Video Preload Behavior**: The mascot video has `preload="auto"`, which may load immediately and waste bandwidth. For better performance, use `preload="none"` and start playback when needed (e.g., on visibility).  
  **Note**: `autoplay` with `muted` is generally allowed, but `preload="auto"` can be adjusted.  

- **Redundant CSS Selectors**: The `.floating-mascot` CSS uses both `.floating-mascot` and `#floating-mascot` selectors. Use the ID (`#floating-mascot`) for specificity and remove redundant `.floating-mascot` rules to simplify maintenance.  

---

### **3. UI Consistency & Feedback**  
- **Send Button Disabled State**: The `#send-button` is disabled but lacks visual cues (e.g., grayed-out text). Ensure the CSS for disabled buttons is clear:  
  ```css
  .composer-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      background-color: #444 !important; /* Match disabled theme color */
  }
  ```  

- **Tab Switching Feedback**: When switching tabs (e.g., `#tab-btn-script-library`), update the `aria-expanded` attribute of the active `.tab-pane` and ensure the UI reflects the current tab (e.g., highlight the active tab button).  
  **Fix**: In `tab-switching.js`, add logic to:  
  ```javascript
  // When a tab button is clicked
  tabButton.addEventListener('click', () => {
      const currentTab = document.querySelector(`#${tabButton.dataset.tab}`);
      // Update aria-expanded for all tabs
      document.querySelectorAll('.tab-btn').forEach(btn => {
          const tabId = `#${btn.dataset.tab}`;
          document.querySelector(tabId)?.setAttribute('aria-expanded', btn.classList.contains('active'));
      });
      // ...
  });
  ```  

- **Chat History Loading State**: The `#conversation-list` shows "Loading..." but lacks `aria-live` to announce updates. Add `aria-live="polite"`:  
  ```html
  
      Loading conversations...
  
  ```  

---

### **4. CEP-Specific Compatibility**  
- **File Protocol Handling**: CEP extensions often run via `file://` URLs. Ensure the storage polyfill and any network requests (e.g., YouTube oEmbed) work in this environment. For example, `fetch` in `file://` may block cross-origin requests; test if `secureAPIStorage.js` handles this.  

- **AE Integration Hints**: The `app-initializer.js` and `advanced-sdk-integration.js` scripts should expose AE-specific functions (e.g., `app.project`, `app.beginUndoGroup`) to the UI. Add comments or ensure these are accessible globally (if not already).  

- **Mascot Animation Fallback**: The WebM mascot video is hidden initially (`class="hidden"`), but the GIF fallback is `display: block !important`. If WebM fails, ensure the GIF is visible and the video is hidden. The existing script handles this, but confirm `#floating-mascot-fallback`’s `display` property is controlled via CSS classes (not inline `style`).  

---

### **5. Error Handling & Logging**  
- **Voice Input Error Feedback**: If voice input fails (e.g., user denies microphone access), the UI should notify the user. Add a `role="alert"` to a hidden message that’s shown on errors.  
  **Example**:  
  ```html
  
  ```  
  Update `voice-features.js` to populate this div on errors.  

- **Chat Input Validation**: The `#chat-input` has `maxlength="1000"`, but no client-side validation for empty input. Add a check to disable `#send-button` until input is non-empty.  
  **Fix**: In `ui-bootstrap.js` or `input-validator.js`:  
  ```javascript
  chatInput.addEventListener('input', (e) => {
      const isEmpty = e.target.value.trim().length === 0;
      sendButton.disabled = isEmpty;
  });
  ```  

---

### **6. Code Organization & Maintainability**  
- **Script Grouping**: The `` tags are grouped logically, but ensure dependencies are respected. For example, `settings-manager.js` should load before `secure-api-settings-ui.js` if the UI relies on it.  

- **Local Storage Usage**: The `secureAPIStorage.js` is used, but verify it encrypts sensitive data (e.g., `apiKey`). The current polyfill overwrites `localStorage`, which may conflict with AE’s native storage—consider scoping storage (e.g., prefix keys with `letterblack-genai-`).  

- **Module Monitoring**: `module-monitor.js` is loaded; ensure it tracks script loading failures and logs them (e.g., missing `voice-features.js`).  

---

### **7. Missing Features & UX Improvements**  
- **Chat Scroll Enhancement**: The `chat-scroll-enhancement.js` is included, but confirm it auto-scrolls to new messages (users expect this in chat UIs).  

- **Project Context Sync**: The `#memory-textarea` in the settings tab is for "Project Context". Add a button to "Sync Context" with the current chat session, or auto-sync when the textarea changes.  

- **AI Status Indicator**: The `#current-model-display` in `#model-status-overlay` shows "Loading...", but should reflect the active provider/model (e.g., "Google Gemini (gemini-2.5-flash)"). Update `ai-status.js` to populate this dynamically.  

- **Clear History Confirmation**: The `#clear-history-btn` in `#chat-history-tab` deletes all history without confirmation. Add a dialog (via `window.confirm` or a custom UI) to prevent accidental data loss.  

---

### **8. Accessibility for Hidden Elements**  
- **Hidden Indicators**: The `#context-indicator` and `#effects-indicator` have `aria-hidden="true"`. If they’re hidden but still relevant, use `hidden` class with `aria-hidden` toggled via JS (not hardcoded).  
  **Fix**:  
  ```html
  
  
  ```  
  When showing:  
  ```javascript
  contextIndicator.classList.remove('hidden');
  contextIndicator.setAttribute('aria-hidden', false);
  ```  

---

### **Summary of Critical Fixes**  
1. **Accessibility**: Add ARIA roles, labels, and `aria-live` to dynamic elements.  
2. **Dynamic Updates**: Ensure char count, voice rate, and loading states update in real-time.  
3. **Performance**: Remove CDN dependencies (e.g., Prism.js) and optimize resource loading.  
4. **UI Feedback**: Clarify disabled states (send button, voice input) and add confirmation dialogs.  
5. **CEP Compatibility**: Validate file protocol behavior and ensure AE SDK integration.  

These changes will make the UI more user-friendly, accessible, and robust in CEP environments. Let me know if you need help implementing specific fixes!




The provided `ui-bootstrap.js` is a comprehensive UI initialization script, but there are **key improvements and fixes** to enhance robustness, maintainability, accessibility, and CEP compatibility. Here’s a detailed breakdown:

---

### **1. **XSS/Sanitize HTML Enhancements****  
The `sanitizeHtml` function aims to preserve code blocks but has inconsistencies:  
- **Issue**: The regex `/```[\s\S]*```/` may not correctly capture multi-line code blocks (e.g., fails with `\n` inside).  
- **Fix**: Use a more precise regex with multi-line support and ensure code content is properly escaped.  
  ```javascript
  function sanitizeHtml(input) {
      if (typeof input !== 'string') return '';
      const normalized = input.replace(/\r\n?/g, '\n'); // Normalize CRLF
      // Improved code block regex (captures language and content, handles newlines)
      return normalized.replace(/```([\w-]*)\n([\s\S]*?)\n```/g, (_, lang, code) => {
          return `${escapeHtml(code)}`;
      }).replace(/\n/g, ''); // Convert newlines to  outside code blocks
  }
  ```  

- **Issue**: The `append` function in `initChatComposer` uses `innerHTML` but assumes `sanitizeHtml` is safe. Verify `sanitizeHtml` doesn’t introduce unintended HTML.  
- **Fix**: Ensure `sanitizeHtml` escapes all non-allowlisted tags. For example, disallow `` tags even if they’re part of user input.  

---

### **2. **Secure Storage Improvements****  
- **Issue**: `secureStorage` is initialized with `require`, which may not work in browser environments (CEP uses `window` for modules).  
- **Fix**: Replace `require` with direct global access (assuming `secureAPIStorage` is exposed globally):  
  ```javascript
  async function initSecureStorage() {
      try {
          // Assume secureAPIStorage is loaded and available as window.secureAPIStorage
          secureStorage = window.secureAPIStorage ?? new SecureAPIStorage(); // If not, use fallback
          if (secureStorage) {
              await secureStorage.ensureDirs();
          }
      } catch (error) {
          console.warn('Secure storage init failed, using localStorage fallback:', error);
      }
  }
  ```  

- **Issue**: Fallback storage uses `localStorage` but doesn’t persist data (the polyfill in HTML is in-memory).  
- **Fix**: Ensure fallback storage (if needed) uses `localStorage` correctly. However, for CEP, prefer using AE’s native `cepStorage` (if available) over browser `localStorage` for persistence:  
  ```javascript
  // In secureGet/secureSet, check for AE's cepStorage first
  async function secureGet(key, defaultValue = null) {
      try {
          // Prefer AE's cepStorage if available (common in CEP)
          if (window.cepStorage) {
              return cepStorage.getItem(key, defaultValue);
          }
          // Fallback to secureStorage (your custom module)
          if (secureStorage) {
              const settings = await secureStorage.loadSettings();
              return settings[key] ?? defaultValue;
          }
          // Last resort: browser localStorage (but ensure it’s persisted)
          const value = localStorage.getItem(key);
          return value ? JSON.parse(value) : defaultValue;
      } catch (error) {
          console.error('Failed to get value:', error);
          return defaultValue;
      }
  }
  ```  

- **Issue**: `secureSet` in fallback mode stringifies values but doesn’t handle `undefined`/`null` gracefully.  
- **Fix**:  
  ```javascript
  async function secureSet(key, value) {
      try {
          if (window.cepStorage) {
              cepStorage.setItem(key, value);
              return;
          }
          if (secureStorage) {
              const settings = await secureStorage.loadSettings();
              settings[key] = value;
              await secureStorage.saveSettings(settings);
              return;
          }
          // Fallback to localStorage (stringify only if not null/undefined)
          const toStore = value === null || value === undefined ? '' : JSON.stringify(value);
          localStorage.setItem(key, toStore);
      } catch (error) {
          console.error('Failed to set value:', error);
          throw new Error(ErrorMessages.STORAGE_ERROR);
      }
  }
  ```  

---

### **3. **Chat History and Messages****  
- **Issue**: `initChatHistory`’s `save` function may save invalid messages (e.g., empty text).  
- **Fix**: Add validation before saving:  
  ```javascript
  const save = withErrorBoundary(async function() { 
      if (!chatMessages) return; 
      
      const msgs = Array.from(chatMessages.querySelectorAll('.message'))
          .map(m => { 
              const contentEl = m.querySelector('.message-content');
              const timestampEl = m.querySelector('.message-timestamp');
              
              const text = contentEl?.innerText || '';
              const type = m.classList.contains('user') ? 'user' : 'system';
              const timestamp = timestampEl?.innerText || new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
              
              return { type, text, timestamp }; 
          })
          .filter(msg => validateMessage(msg)); // Use validateMessage
      
      await secureSet('ae_chat_history', msgs); 
  });
  ```  

- **Issue**: `initChatComposer`’s `append` function appends raw `response` text (from AI) without sanitization.  
- **Fix**: Ensure AI-generated responses are sanitized before appending:  
  ```javascript
  if (response && validateText(response, 1, 50000)) { 
      append('system', sanitizeHtml(response)); // Sanitize AI response
  }
  ```  

- **Issue**: The `append` function in `initYouTubeAnalyzer` appends `analysis` (an object) directly, which converts to `[object Object]` in the UI.  
- **Fix**: Extract a user-friendly summary from `analysis.data` (e.g., `analysis.data.summary` if available):  
  ```javascript
  append('system', `YouTube Analysis:\n\n${JSON.stringify(analysis.data, null, 2)}`); // Or format as text
  ```  

---

### **4. **Input Validation and Edge Cases****  
- **Issue**: `initChatComposer`’s `sendMessage` retrieves `apiKey` from `window.cepStorage`, but `cepStorage` isn’t defined here. Assume `cepStorage` is a global alias for secure storage.  
- **Fix**: Clarify storage access:  
  ```javascript
  const apiKey = (await secureGet('apiKey')) || '';
  const provider = (await secureGet('apiProvider')) || 'google';
  const model = (await secureGet('apiModel')) || 'gemini-2.5-flash-preview-05-20';
  ```  

- **Issue**: The `paste` event handler truncates messages but doesn’t validate the truncated text.  
- **Fix**: Validate after truncation:  
  ```javascript
  input.addEventListener('paste', function(e) { 
      setTimeout(() => { 
          let val = input.value.trim();
          if (val.length > maxLen) { 
              val = val.substring(0, maxLen);
              input.value = val;
              showError(`Message truncated to ${maxLen} characters`);
          }
          charCount.textContent = `${val.length}/${maxLen}`;
          sendButton.disabled = val.length === 0;
      }, 0); 
  });
  ```  

- **Issue**: `initChatComposer`’s `sendHandler` and `keyHandler` both call `sendMessage`, leading to duplicate code.  
- **Fix**: Extract common logic into a shared function:  
  ```javascript
  const handleSend = withErrorBoundary(async (val) => {
      append('user', val); 
      input.value = ''; 
      update(); 
      await sendMessage(val);
  });

  sendButton.addEventListener('click', () => handleSend(input.value.trim()));
  input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          const val = input.value.trim();
          if (val) handleSend(val);
      }
  });
  ```  

---

### **5. **Accessibility Enhancements****  
- **Issue**: Chat messages lack `role="article"` for screen readers.  
- **Fix**: Add `role="article"` to each `.message` div in `append`:  
  ```javascript
  const d = document.createElement('div'); 
  d.className = `message ${type}`; 
  d.role = 'article'; // Screen reader-friendly
  ```  

- **Issue**: The `chat-messages` container lacks `aria-live` to announce new messages.  
- **Fix**: Add `aria-live="polite"` to `chat-messages`:  
  ```javascript
  // In initChatHistory, when creating chatMessages:
  chatMessages.setAttribute('aria-live', 'polite');
  ```  

- **Issue**: The `char-count` span doesn’t update when messages are loaded from storage.  
- **Fix**: Trigger `update` in `initChatHistory`’s `load` function:  
  ```javascript
  const load = withErrorBoundary(async function() { 
      // ... existing load logic ...
      await fetchAndRenderMessages();
      update(); // Update char count after messages loaded
  });
  ```  

---

### **6. **Mascot and Animation Cleanup****  
- **Issue**: `initFloatingMascot` adds event listeners (e.g., `click`, `mouseenter`) but doesn’t register them for cleanup.  
- **Fix**: Use `registerCleanup` to remove listeners:  
  ```javascript
  function initFloatingMascot() { 
      const floating = document.getElementById('floating-mascot'); 
      if (!floating) return; 

      // ... existing code ...

      floating.addEventListener('click', onClick); 
      floating.addEventListener('mouseenter', onMouseEnter); 
      floating.addEventListener('mouseleave', onMouseLeave); 

      registerCleanup(() => { 
          floating.removeEventListener('click', onClick); 
          floating.removeEventListener('mouseenter', onMouseEnter); 
          floating.removeEventListener('mouseleave', onMouseLeave); 
      }); 

      // Define onMouseEnter/Leave as named functions
      function onMouseEnter() { ... }
      function onMouseLeave() { ... }
  }
  ```  

- **Issue**: Mascot asset paths (e.g., `'Reusable_Mascot_System/assets/'`) may not align with the extension’s actual directory.  
- **Fix**: Use relative paths or a base path variable (e.g., `const assetBase = 'assets/'`) for consistency.  

---

### **7. **Command Palette and Keyboard Navigation****  
- **Issue**: The `commandSearch` `keydown` listener for arrows may not work if `.command-item` elements aren’t focusable.  
- **Fix**: Ensure `.command-item` buttons have `tabindex="0"` and handle focus:  
  ```html
  
  ...
  ```  

- **Issue**: The command palette’s `aria-hidden` state isn’t updated correctly when toggled.  
- **Fix**: In `openCommandPalette`/`closeCommandPalette`, explicitly set `aria-hidden`:  
  ```javascript
  commandPanel.classList.remove('hidden');
  commandPanel.setAttribute('aria-hidden', 'false'); // Open state
  ```  

---

### **8. **Bottom Panel Resizer Robustness****  
- **Issue**: The resizer’s saved height (`STORAGE_KEY`) may be invalid (e.g., non-numeric).  
- **Fix**: Parse and validate the saved value:  
  ```javascript
  const saved = localStorage.getItem(STORAGE_KEY);
  const defaultHeight = '300px'; // Adjust as needed
  if (saved && /^\d+px$/.test(saved)) {
      panel.style.height = saved;
  } else {
      panel.style.height = defaultHeight;
      localStorage.setItem(STORAGE_KEY, defaultHeight); // Reset invalid value
  }
  ```  

- **Issue**: The resizer’s `mousedown` listener isn’t registered for cleanup.  
- **Fix**: Add to `registerCleanup`:  
  ```javascript
  resizer.addEventListener('mousedown', startDrag);
  registerCleanup(() => {
      resizer.removeEventListener('mousedown', startDrag);
  });
  ```  

---

### **9. **Error Boundary and Feedback****  
- **Issue**: Some error handlers (e.g., in `initYouTubeAnalyzer`) don’t clear loading messages properly.  
- **Fix**: Use a helper to remove the last message if it’s a loading indicator:  
  ```javascript
  function clearLoadingMessage(container) {
      const lastMsg = container.querySelector('.message:last-child');
      if (lastMsg?.textContent?.includes('Analyzing')) lastMsg.remove();
  }

  // In initYouTubeAnalyzer's try/catch:
  try {
      clearLoadingMessage(chatMessages);
      // ... analysis logic ...
  } catch (error) {
      clearLoadingMessage(chatMessages);
      // ... error handling ...
  }
  ```  

- **Issue**: The `showError` div uses inline styles. Hard to maintain and may conflict with CSS.  
- **Fix**: Define a CSS class for errors and apply it:  
  ```css
  /* Add to CSS */
  .ui-error-toast {
      position: fixed; top: 10px; right: 10px; z-index: 10000;
      background: #ff4444; color: white; padding: 12px 16px;
      border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      max-width: 300px; font-size: 12px; font-family: Arial, sans-serif;
      display: none;
  }
  ```  
  Then update `showError`:  
  ```javascript
  function showError(message) {
      console.error('UI Error:', message);
      let errorDiv = document.getElementById('ui-error-display');
      if (!errorDiv) {
          errorDiv = document.createElement('div');
          errorDiv.id = 'ui-error-display';
          errorDiv.className = 'ui-error-toast';
          document.body.appendChild(errorDiv);
      }
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      setTimeout(() => errorDiv.style.display = 'none', 5000);
  }
  ```  

---

### **10. **Code Organization and Readability****  
- **Issue**: Duplicate `append` functions in `initChatComposer` and `initYouTubeAnalyzer`.  
- **Fix**: Extract a shared `appendMessage` function:  
  ```javascript
  function appendMessage(type, text, container) {
      if (!container) return;
      if (!['user', 'system'].includes(type)) return;
      if (!validateText(text)) return;

      const msgDiv = document.createElement('div');
      msgDiv.className = `message ${type}`;
      msgDiv.role = 'article'; // Accessibility

      const contentDiv = document.createElement('div');
      contentDiv.className = 'message-content';
      contentDiv.innerHTML = `${sanitizeHtml(text)}`; // Sanitize text

      const timestampDiv = document.createElement('div');
      timestampDiv.className = 'message-timestamp';
      timestampDiv.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

      msgDiv.appendChild(contentDiv);
      msgDiv.appendChild(timestampDiv);
      container.appendChild(msgDiv);
      container.scrollTop = container.scrollHeight; // Auto-scroll
  }

  // Usage in initChatComposer:
  appendMessage('user', val, chatMessages);
  ```  

---

### **11. **Dependency and Module Checks****  
- **Issue**: `initMascot` assumes `MascotAnimator` is globally available but doesn’t handle initialization failures.  
- **Fix**: Add fallback behavior:  
  ```javascript
  function initMascot() { 
      try { 
          if (typeof MascotAnimator !== 'undefined') { 
              const mascot = new MascotAnimator({
                  mascotGif: 'assets/ae-mascot-animated.gif', // Use GIF animation
                  mascotFallback: 'assets/ae-mascot.png',
                  zIndex: 999999
              }); 
              mascot.showWelcome({ text: 'Welcome', message: 'LetterBlack_Gen_AI — ready to assist' }); 
              window.__mascot = mascot; 
          } else {
              console.warn('MascotAnimator not found. Mascot disabled.');
          }
      } catch (e) { 
          console.warn('Mascot initialization failed:', e); 
          showError('Mascot system unavailable.');
      } 
  }
  ```  

---

### **12. **API Key Save Guard****  
- **Issue**: The `save-and-test-btn`’s click handler in `initChatComposer` only shows a toast but doesn’t actually save settings.  
- **Fix**: Integrate with `settings-manager.js` to persist API keys properly:  
  ```javascript
  if (saveAndTestBtn) {
      saveAndTestBtn.addEventListener('click', async () => {
          const apiKey = document.getElementById('api-key-setting')?.value.trim();
          if (!validateText(apiKey, 10)) {
              showError('Invalid API key.');
              return;
          }
          await secureSet('apiKey', apiKey);
          await secureSet('apiProvider', document.getElementById('api-provider')?.value);
          await secureSet('apiModel', document.getElementById('model-select-setting')?.value);
          if (window.SimpleToast) window.SimpleToast.show('Settings saved successfully.', 'success');
      });
  }
  ```  

---

### **Summary of Critical Fixes**  
- **Sanitize HTML Properly**: Ensure code blocks and user input are safe from XSS.  
- **Secure Storage Consistency**: Use AE’s `cepStorage` or your `secureAPIStorage` uniformly.  
- **Accessibility**: Add `role` and `aria-live` attributes for screen readers.  
- **Cleanup Handlers**: Register all event listeners for cleanup to prevent memory leaks.  
- **Error Feedback**: Improve error messages with context and use CSS classes for toasts.  
- **Input Validation**: Validate all user inputs and handle edge cases (e.g., pasted text truncation).  

These changes will make the UI more reliable, accessible, and aligned with CEP best practices. Let me know if you need help implementing specific parts!



